function startApp(){btnAddTask(),getProjectTasks(),getCountProjectTasks()}document.addEventListener("DOMContentLoaded",startApp),setInterval(()=>{getProjectTasks()},1e4);let tasks=[];async function getProjectTasks(){try{const t="/dashboard/project-tasks?id="+getUrlProject(),e=await fetch(t),a=await e.json();tasks=a.tasks,showProjectTasks()}catch(t){return void message("error","Task Failed","An error occurred while getting the task, please try again later!")}}async function getCountProjectTasks(){try{const t="/dashboard/project-tasks?id="+getUrlProject(),e=await fetch(t),a=(await e.json()).tasks.length,n=tasks.filter(t=>"completed"===t.state).length;document.getElementById("count-project-tasks").textContent=` ${n} / ${a} tasks completed`}catch(t){return void message("error","Task Failed","An error occurred while getting the task, please try again later!")}}function btnAddTask(){document.getElementById("add-project-task").addEventListener("click",()=>{modal()})}function modal(t=!1,e={}){Swal.fire({title:""+(t?"Edite task details":"Enter task details"),html:`\n            <div class="container-task">\n                <div class="container-task__item">\n                    <label for="title" class="swal2-label">Task Title:</label>\n                    <input type="text" id="title" placeholder="${t?"Edite title task...":"Task title here..."}" class="swal2-input" value="${e.title?e.title:""}">\n                </div>\n            </div>\n        `,showCancelButton:!0,showCloseButton:!0,confirmButtonText:""+(t?"Save changes":"Add Task"),confirmButtonColor:"#697199",cancelButtonText:"Cancel",cancelButtonColor:"#DC3741",preConfirm:()=>{if(""===document.getElementById("title").value.trim())return Swal.showValidationMessage("Make sure all fields are complete."),!1}}).then(a=>{if(1==a.isConfirmed){const a=document.getElementById("title").value.trim();t?(e.title=a,updateTask(e)):createTask(a)}})}async function createTask(t){const e=new FormData;e.append("title",t),e.append("projectId",getUrlProject());try{const a="http://localhost:3000/api/project-tasks/create",n=await fetch(a,{method:"POST",body:e}),s=await n.json();if("success"===s.type){message("success","Task Created Successfully","The task was created successfully!");const e={id:String(s.id),title:t,date:s.date,projectId:s.projectId,state:"pending"};tasks=[...tasks,e],showProjectTasks(),getCountProjectTasks()}}catch(t){return void message("error","Task Create Failed","An error occurred while creating the task, please try again later!")}}function getUrlProject(){const t=new URLSearchParams(window.location.search);return Object.fromEntries(t.entries()).id}function changeState(t){Swal.fire({icon:"question",title:"Do you want to update the status of the task?",showDenyButton:!0,showCloseButton:!0,confirmButtonText:"Update",denyButtonText:"Cancel",confirmButtonColor:"#697199"}).then(e=>{if(e.isConfirmed){const e="completed"===t.state?"pending":"completed";t.state=e,updateTask(t)}})}async function updateTask(t){const{id:e,title:a,state:n}=t,s=new FormData;s.append("id",e),s.append("title",a),s.append("state",n),s.append("projectId",getUrlProject());try{const t="http://localhost:3000/api/project-tasks/update",o=await fetch(t,{method:"POST",body:s});"success"===(await o.json()).type&&message("success","Task Status Updated","The task was updated successfully!"),tasks=tasks.map(t=>(t.id===e&&(t.title=a,t.state=n),t)),showProjectTasks(),getCountProjectTasks()}catch(t){return void message("error","Task Updatgin Failed","An error occurred while updating the task, please try again later!")}}function confirmDelete(t){Swal.fire({icon:"question",title:"Are you sure you want to delete the task?",showCancelButton:!0,showCloseButton:!0,confirmButtonText:"Delete",cancelButtonText:"Cancel",confirmButtonColor:"#697199"}).then(e=>{e.isConfirmed&&deleteTask(t)})}async function deleteTask(t){const{id:e,title:a,date:n,state:s}=t,o=new FormData;o.append("id",e),o.append("title",a),o.append("date",n),o.append("state",s),o.append("projectId",getUrlProject());try{const e="http://localhost:3000/api/project-tasks/delete",a=await fetch(e,{method:"POST",body:o});"success"===(await a.json()).type&&(message("success","Task Deleted Succesffully","The task was deleted successfully!"),tasks=tasks.filter(e=>e.id!==t.id),getCountProjectTasks(),showProjectTasks())}catch(t){return void message("error","Task deleted Failed","An error occurred while deleting the task, please try again later!")}}function showProjectTasks(){if(clearHTML(),0===tasks.length){const t=document.createElement("DIV");t.className="d-flex justify-content-center mt-5 alert w-100";const e=document.createElement("DIV");return e.className="alert alert-danger fs-3 fw-semibold text-center w-auto",e.setAttribute="alert",e.textContent="It looks like you haven`t added any tasks yet, start by adding a task!",t.appendChild(e),void document.getElementById("container-project-tasks").appendChild(t)}const t={pending:"pending",completed:"completed"};tasks.forEach(e=>{const a=document.createElement("LI");a.className="task rounded-4 d-flex align-items-center justify-content-between p-3 rounded mb-3 shadow-sm";const n=document.createElement("DIV");n.className="task__info";const s=document.createElement("H4");s.className="task__title fw-semibold",s.textContent=e.title;const o=document.createElement("DIV");o.className="task__footer d-flex align-items-center gap-3";const c=document.createElement("P");c.className="task__date mb-0 fs-5";const r=e.date,d=new Date(r),l=new Date,i=l-d,u=Math.floor(i/6e4);let p="";if(console.log("Tiempo transcurrido: ",u),u<=2)p="Added now";else if(u<=10)p=u+" min ago";else if(d.getDate()===l.getDate())p="Added today";else{const t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=d.getDate();p=""+`${t[d.getMonth()]} ${e}`}c.textContent=p;const m=document.createElement("BUTTON");m.setAttribute("type","button"),m.className="card__button-state rounded-2 fw-bold fs-6 text-uppercase p-2 "+t[e.state].toLowerCase(),m.textContent=t[e.state],m.dataset.stateTask=e.state,"pending"===e.state?m.classList.add("card__button-state--pending"):m.classList.add("card__button-state--complete"),m.onclick=function(){changeState({...e})};const h=document.createElement("DIV");h.className="d-flex align-items-center gap-4";const k=document.createElement("DIV");k.innerHTML='\n            <button type="button" class="btn options btn-outline-transparent" data-bs-toggle="dropdown" aria-expanded="false" aria-label="button with actions">\n                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-three-dots-vertical" viewBox="0 0 16 16">\n                    <path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"/>\n                </svg>\n            </button>\n        ';const g=document.createElement("UL");g.classList.add("dropdown-menu","p-2");const f=document.createElement("LI"),w=document.createElement("BUTTON");w.setAttribute("type","button"),w.className='button-actions rounded button-actions--edite d-flex align-items-center gap-3 w-100 fs-4 mb-2"',w.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />\n            </svg>\n            <span>Edite</span>\n        ',w.onclick=function(){modal(!0,{...e})};const T=document.createElement("LI"),C=document.createElement("BUTTON");C.setAttribute("type","button"),C.className="button-actions rounded button-actions--delete d-flex align-items-center gap-3 w-100 fs-4",C.innerHTML='\n            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">\n                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />\n            </svg>\n            <span>Delete</span>\n        ',C.onclick=function(){confirmDelete(e)},a.appendChild(n),n.appendChild(s),n.appendChild(o),o.appendChild(m),o.appendChild(c),a.appendChild(h),h.appendChild(k),k.appendChild(g),g.appendChild(f),g.appendChild(T),f.appendChild(w),T.appendChild(C),document.getElementById("container-project-tasks").appendChild(a)})}function clearHTML(){const t=document.getElementById("container-project-tasks");for(;t.firstChild;)t.removeChild(t.firstChild)}function message(t,e,a){Swal.fire({position:"top-end",icon:t,title:e,text:a,showConfirmButton:!1,allowOutsideClick:!1,timer:2e3})}
//# sourceMappingURL=projectTask.js.map
